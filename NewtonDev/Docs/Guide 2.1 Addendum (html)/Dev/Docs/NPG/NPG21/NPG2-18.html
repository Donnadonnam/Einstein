<!-- Generated by Harlequin WebMaker 2.3.1 (16-Oct-1996)Macintosh Common Lisp Version 4.0 --><HTML> <HEAD><TITLE>Creating the DataDef</TITLE></HEAD><BODY><A NAME=HEADING18></A><CENTER>     <IMG BORDER="0" SRC="../../../../images/level3.gif" ALT="Title Banner"      ISMAP USEMAP="#level3">     <BR>     <MAP NAME="level3">     <!-- Find It -->     <AREA SHAPE="RECT" COORDS="7, 9, 69, 30" HREF="../../../../find.html">     <!-- Main -->     <AREA SHAPE="RECT" COORDS="432, 9, 492, 30" HREF="../../../../devworld.shtml">     </MAP><P><A HREF="NPG2-17.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-19.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><FONT SIZE=-1><DL><DT><A HREF="../../techinfo.html"><B>Newton Developer Technical Information:</B></A> <A HREF="NPG2-2.html"><B>Newton Programmer's Guide: 2.1 OS Addendum</B></A> / <BR><DD><A HREF="NPG2-12.html"><B>Chapter 1 - Newton Works</B></A> / <A HREF="NPG2-16.html"><B>Using the Newton Works Interface</B></A></DL></FONT><P><HR><BLOCKQUOTE><A NAME=HEADING18-0></A><H2>Creating the DataDef</H2> You must use the standard stationery proto, <CODE>newtStationery</CODE>, to create a dataDef for Newton Works. The <CODE>superSymbol</CODE> slot of the dataDef must be set to the symbol <CODE>'newtWorks</CODE>. This associates the stationery with the Newton Works application.<P> Note that as in the NewtApp framework, the symbol of the dataDef is used as the <CODE>class</CODE> slot of soup entries created by that dataDef.<P> Certain slots are required for all dataDefs, such as <CODE>symbol</CODE>, <CODE>name</CODE>, <CODE>description</CODE>, <CODE>superSymbol</CODE>, <CODE>icon</CODE>, <CODE>StringExtract</CODE>, <CODE>TextScript</CODE>, <CODE>FillNewEntry</CODE>, etc. For details on these standard NewtApp slots and methods, refer to the "NewtApp Reference" chapter of <I>Newton Programmer's Reference</I>. The only dataDef slot unique to Newton Works is the <CODE>prefs</CODE> slot. See the next section for details on how it is used.<P><A NAME=HEADING18-4></A><H3>Supporting Application-Defined Preferences</H3> The dataDef can specify an application-specific preferences command that appears in the Info button picker when the user is viewing an entry of the dataDef. If this command is chosen, a preferences slip is displayed. To implement this feature, define a slot called <CODE>prefs</CODE> in the dataDef. This slot contains a frame defining the command name and icon to show in the Info picker and the frame contains a view template defining the actual preferences slip. <A HREF=#MARKER-9-20>Figure 1-2</A> shows an example of the Info picker with one application-specific preferences command added for the word processor stationery type (paper).<P> Note that there are also global preferences that apply to all Newton Works applications. These are accessed through the Works Prefs choice on the Info picker. For more information about handling global preferences, see the section <A HREF=NPG2-278.html#MARKER-9-119>&quot;Notification of Changes&quot;</A>.<P><B>Figure 1-2  <A NAME=MARKER-9-20></A>Info picker</B><P><IMG ALIGN = BOTTOM SRC = "graphics/NWDocPrf.jpg"><BR><BR> When the user chooses the application-specific preferences command from the Info button, Newton Works sets the slots <CODE>target</CODE> (the soup entry being viewed), <CODE>newtAppBase</CODE> (the Newton Works base view), and <CODE>viewDefView</CODE> (the current viewDef) appropriately in the preferences view template. Then it calls <CODE>BuildContext</CODE>(<I>prefsTemplate</I>) to create and display the preferences view. <P> The preferences view must read the appropriate preferences slots in its <CODE>ViewSetupFormScript</CODE> method (or other initialization method), and write the slots in its <CODE>ViewQuitScript</CODE> method (or before it closes). The preferences reside in the application preferences frame, which you can get using the <CODE>newtApplication</CODE> method <CODE>GetAppPreferences</CODE>. The preferences for the dataDef must reside in a subframe for that dataDef within the preferences frame. For example,<P><PRE><P> prefsFrame := newtAppBase:GetAppPreferences().(kDataSymbol);<P></PRE> should return the preferences for the dataDef identified by <CODE>kDataSymbol</CODE>.<P> To save the preferences, call <CODE>EntryChangeXmit(prefsFrame, kDataSymbol)</CODE>.<P> Note that the preferences view must be closed by calling <CODE>newtAppBase:RememberedClose(<I>base)</I></CODE>, otherwise, Newton Works keeps a reference to the view and it uses up RAM. For example, here's how you would write the <CODE>ButtonClickScript</CODE> method for the close box of the preferences view:<P><PRE><P> ButtonClickScript: func() begin<P>   newtAppBase:RememberedClose(base); end<P><P></PRE><A NAME=HEADING18-18></A><H3><A NAME=MARKER-10-21></A>Adding Information to the Title Slip</H3> The dataDef can specify extra information that appears in the title slip for documents. To do so, you must implement the <A HREF=NPG2-30.html#MARKER-9-46><EM>*</EM></A><CODE>InfoBoxExtract</CODE> method in the dataDef. This method is called conditionally by Newton Works whenever the title slip is opened.<P> You must return a shape from the <A HREF=NPG2-30.html#MARKER-9-46><EM>*</EM></A><CODE>InfoBoxExtract</CODE> method. This shape is shown at the bottom of title slip, after the standard contents. You could return a text summary made into a shape, or a small sketch of a drawing, or anything else useful to show in the title slip. <A HREF=#MARKER-9-22>Figure 1-3</A> shows an example of the title slip for the Newton Works word processor. It has one extra line, showing the number of pages, added to the default slip. Here's an example of code that could be used to add that line:<P><PRE><P> InfoBoxExtract: func(target, maxSize, viewDefView) begin<P>   local numPages := if viewDefView then viewDefView:?GetCountPages();   if numPages then      [MakeText(ParamStr(&quot;Number of Pages: ^0, [numPages]), maxSize.left, maxSize.top, maxSize.right, maxSize.top+15)]; end<P><P></PRE> If you don't want to add any extra information, don't implement the <CODE><A HREF=NPG2-30.html#MARKER-9-46><EM>*</A>InfoBoxExtract</EM></CODE> method, or return <CODE>nil</CODE> from it.<P><B>Figure 1-3  <A NAME=MARKER-9-22></A>Title slip</B><P><IMG ALIGN = BOTTOM SRC = "graphics/NWDocTtl.jpg"><BR><BR><A NAME=HEADING18-29></A><H3><A NAME=MARKER-9-23></A>Supporting Newton Find Operations</H3> A Newton Find operation is a search initiated by the user tapping the main Find icon. Such a search can include all, some, or just one Newton application. In this kind of Find operation, Newton Works is considered a single application, including all of the individual stationery installed in it. Contrast this with a Newton Works document Find operation, which is initiated by the user tapping the Find choice in the Tools picker inside a particular document. This kind of Find operation applies only to the single Newton Works document that is open, and is described in the section <A HREF=NPG2-19.html#MARKER-9-24>&quot;Supporting Document Find&quot;</A>.<P> To support a Newton Find operation that includes Newton Works, Newton Works first uses the <CODE>FindStringInFrame</CODE> function to search for a specified string in all soups. If this function does not find a match in a particular soup entry, Newton Works sends your dataDef the <A HREF=NPG2-29.html#MARKER-9-44><EM>*</EM></A><CODE>FindFn</CODE> message to allow you to do your own search of that soup entry. Note that <A HREF=NPG2-29.html#MARKER-9-44><EM>*</EM></A><CODE>FindFn</CODE> is called only if Newton Works doesn't find a match by using <CODE>FindStringInFrame</CODE>.<P> The <A HREF=NPG2-29.html#MARKER-9-44><EM>*</EM></A><CODE>FindFn</CODE> method gives you the opportunity to find data that may be stored in non-standard ways, that only your stationery knows how to decode. For example, if you compress entries, you might need to decompress them in order to do a search.<P> After the Find operation finishes, the system creates a Find overview that displays the found items. It uses the <CODE>FindSoupExcerpt</CODE> function to get a string for each item in the overview. The system sends the <CODE>FindSoupExcerpt</CODE> message to the dataDef for each item found in the Newton Works soups. You must supply this method in your dataDef if you want to specially construct the text that is shown for an item in the overview.<P> If the soup entries contain text information and you don't want to do anything special to construct the overview text, you don't need to implement the <CODE>FindSoupExcerpt</CODE> method. In this case, the system calls the root view method <CODE>FindSoupExcerpt</CODE> to obtain the overview text. This method calls the <CODE>StringExtract</CODE> method of the dataDef to obtain the overview text, or uses other means, if that method returns nothing.<P> In situations where the <CODE>FindStringInFrame</CODE> function is able to find a match, the root view method <CODE>FindSoupExcerpt</CODE> will also be able to display some text for the Find overview. If your Newton Works soup entries store string data with which these functions work, then you don't need to do anything else to support Newton Find operations.<P> In situations where the <CODE>FindStringInFrame</CODE> function does not work to search a soup entry, you'll need to implement both <A HREF=NPG2-29.html#MARKER-9-44><EM>*</EM></A><CODE>FindFn</CODE> and <CODE>FindSoupExcerpt</CODE> methods in your dataDef if you want your data to be searchable in global Find operations.<P> Finally, if your soup is such that sometimes the <CODE>FindStringInFrame</CODE> function will find a match and sometimes the <A HREF=NPG2-29.html#MARKER-9-44><EM>*</EM></A><CODE>FindFn</CODE> is needed, then you must implement a <CODE>FindSoupExcerpt</CODE> method that can handle both cases. In the case of special data found by your own <A HREF=NPG2-29.html#MARKER-9-44><EM>*</EM></A><CODE>FindFn</CODE> method, you will need to return a string for the overview from <CODE>FindSoupExcerpt</CODE>. In the case of simple string data found by <CODE>FindStringInFrame</CODE>, your <CODE>FindSoupExcerpt</CODE> method can call the root method <CODE>FindSoupExcerpt</CODE> to get the overview string, like this:<P><PRE><P> GetRoot():FindSoupExcerpt(entry, resultFrame)<P></PRE> When the user taps an item in the Find overview, or if only a single item is found, the system sends the <CODE>ShowFoundItem</CODE> message to the application that owns that item. For a Newton Works soup item, this message is sent to your stationery viewDef. You must open the appropriate document, highlight the target text, and, if necessary, scroll it to display the text. Note that even though this message is sent to the viewDef, it is documented in this section for completeness.<P> Note that the <CODE>FindSoupExcerpt</CODE> and <CODE>ShowFoundItem</CODE> methods are documented in the <I>Newton Programmer's Reference</I>, since they are standard Newton 2.0 methods. Their use is also covered extensively in the chapter on Find in the <I>Newton Programmer's Guide</I>.<P></BLOCKQUOTE><HR><center><A HREF="NPG2-17.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-19.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><center><font size=-1><A HREF="NPG2-3.html">&copy; Apple Computer, Inc.</A><br>26 APR 1997<P><!--------------------------- Navigation Area ----------------------------------><BR><!-- Navigation Area --><BR><A HREF="reference to server cgi goes here"><IMG BORDER="0" SRC="../../../../images/nav.gif" WIDTH="500" HEIGHT="32" ALT="Navigation graphic, see text links" ISMAP USEMAP="#nav"></A><BR><P><A HREF="../../../../devworld.shtml">Main</A> | <A HREF="../../techinfo.html">Top of Section</A> | <A HREF="../../newtondev.shtml#WhatsNew">What's New</A> | <A HREF="http://www.apple.com/">Apple Computer, Inc.</A> |<A HREF="../../../../find.html">Find It</A> | <A HREF="../../feedback.html">Feedback</A> | <A HREF="../../../../help.html">Help</A></FONT><P></CENTER><!-- Don't forget to add the necessary links for each of these items. --><BR><MAP NAME="nav"><!-- client side map for www.apple.com nav.gif --><!-- Main --><AREA SHAPE="RECT" COORDS="9,6,70,25" HREF="../../../../devworld.shtml"><!-- Page One --><AREA SHAPE="RECT" COORDS="80,6,142,25" HREF="../../techinfo.html"><!-- What's New --><AREA SHAPE="RECT" COORDS="150,5,211,25" HREF="../../newtondev.shtml#WhatsNew"><!-- Apple Logo --><AREA SHAPE="RECT" COORDS="220,6,280,25" HREF="http://www.apple.com/"><!-- Find It --><AREA SHAPE="RECT" COORDS="290,5,350,26" HREF="../../../../find.html"><!-- Contact Us --><AREA SHAPE="RECT" COORDS="361,5,422,25" HREF="../../feedback.html"><!-- Help --><AREA SHAPE="RECT" COORDS="430,5,492,25" HREF="../../../../help.html"><!-- DEFAULT AREA NOT SUPPORTED BY CLIENT SIDE IMAGEMAPS! --></MAP><P></BODY></HTML> 