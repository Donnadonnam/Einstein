<!-- Generated by Harlequin WebMaker 2.3.1 (16-Oct-1996)Macintosh Common Lisp Version 4.0 --><HTML> <HEAD><TITLE>Synthesizing Sound</TITLE></HEAD><BODY><A NAME=HEADING279></A><CENTER>     <IMG BORDER="0" SRC="../../../../images/level3.gif" ALT="Title Banner"      ISMAP USEMAP="#level3">     <BR>     <MAP NAME="level3">     <!-- Find It -->     <AREA SHAPE="RECT" COORDS="7, 9, 69, 30" HREF="../../../../find.html">     <!-- Main -->     <AREA SHAPE="RECT" COORDS="432, 9, 492, 30" HREF="../../../../devworld.shtml">     </MAP><P><A HREF="NPG2-278.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-280.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><FONT SIZE=-1><DL><DT><A HREF="../../techinfo.html"><B>Newton Developer Technical Information:</B></A> <A HREF="NPG2-2.html"><B>Newton Programmer's Guide: 2.1 OS Addendum</B></A> / <BR><DD><A HREF="NPG2-262.html"><B>Chapter 7 - Sound</B></A> / <A HREF="NPG2-274.html"><B>Using Sound</B></A></DL></FONT><P><HR><BLOCKQUOTE><A NAME=HEADING279-0></A><H2><A NAME=MARKER-9-121></A>Synthesizing Sound</H2> The Newton 2.1 OS contains a built-in synthesizer codec that can be used to generate tones based on sine wave addition. You can specify up to 12 individual sine wave tones, which are mixed together to create a sound. Alternately, you can use one of several variants of FM synthesis to create up to four modulated tones (from the base 12), which are mixed together to create a sound.<P> Because the system can play up to four sound channels simultaneously, you can generate quite complex synthesized sounds by using multiple sound channels playing at the same time. Note that multiple sound channels use more heap space, so depending on your application, you may be limited if you are low on heap space.<P> Synthesized sounds are typically much smaller than sampled sounds, so if your application plays custom sounds, you may want to synthesize them rather than using a recorded sample.<P> To use the synthesizer codec, set up the slots in the sound frame like this:<P><PRE><P> {sndFrameType: 'codec, // use a codec<P>codecName: &quot;TDTMFCodec&quot;, // select synthesizer codecbufferSize: 5000, // size of codec buffersbufferCount: 4, // # of codec bufferscompressionType: kSampleLinear, // for playbackdataType: k16bit, // for playbacksamples: mySynthData, // synthesizer binary datasamplingRate: 21600, }<P><P></PRE> There is a shortcut for using the synthesizer codec. You can simply call the <CODE><A HREF=NPG2-326.html#MARKER-9-212><EM>*</A>PlaySound</EM></CODE> function and pass a binary object of the class <CODE>'TDTMFCodec</CODE>, like this:<P><PRE><P> PlaySound(mySynthSound); // class of sound object must be 'TDTMFCodec<P></PRE> <A NAME=MARKER-10-122></A>When passed a binary object of this class, <A HREF=NPG2-326.html#MARKER-9-212><EM>*</EM></A><CODE>PlaySound</CODE> plays it using the synthesizer codec. If the codec is not found, an exception is thrown. This shortcut works for the whole family of <A HREF=NPG2-326.html#MARKER-9-212><EM>*</EM></A><CODE>PlaySound<I>xxx</I></CODE> functions.<P> The data in the <CODE>samples</CODE> slot of the sound frame is a binary object of the class <CODE>'samples</CODE>. You can create binary synthesizer data by using the compile-time function <A HREF=NPG2-438.html#MARKER-9-13><EM>*</EM></A><CODE>MakeBinaryFromHex</CODE>.<P> The data consists of several unsigned short (16-bit) values, structured as follows:<P><PRE><P> type 'DTMF' {<P>unsigned short; /* Parameter block type, set to 1 */unsigned short; /* Synthesis type (0-4) */unsigned short; /* Reserved, set to 0 */unsigned short; /* loop count */unsigned short = $$CountOf(DTMFTones); /* Number of tone blocks */   wide array DTMFTones { /* specify 1 to 12 tone blocks */   unsigned short; /* frequency integer part */   unsigned short; /* frequency fractional part */   unsigned short; /* sustain amplitude */   unsigned short; /* leading silence in ms */   unsigned short; /* attack in ms */   unsigned short; /* decay in ms */   unsigned short; /* sustain in ms */   unsigned short; /* release in ms */   unsigned short; /* peak amplitude */   unsigned short; /* trailing silence in ms */   }; };<P><P></PRE> You can specify up to 12 <CODE>DTMFTones</CODE> blocks describing individual tones that are mixed (added) or modulated together to generate a sound. The different sound synthesis types are explained in <A HREF=#MARKER-9-9>Table 7-2</A>.<p><B>Table 7-2  <A NAME=MARKER-9-9></A>Sound synthesis types</B><TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Synth type<TH>Description<TR><TD>0<TD>This multiple-synthesis type mixes from 1 to 12 pure sine wave tones. Each tone can have its own envelope, amplitude, and frequency. The minimum number of tones required to use this type is 1.<TR><TD>1<TD>This is the most basic FM (frequency modulation) type, and a minimum of 2 tones must be specified to use it. Each tone can have its own amplitude and modulation. The first tone in each pair is the carrier, and the second is the modulation frequency. You can have a maximum of 6 pairs of tones. For example, tones 1 and 2 are the first FM pair, tones 3 and 4 are the second FM pair, and so on. Each pair of tones is modulated together to create one resulting tone, and these resulting tones are then mixed together to generate the sound. So using this type, you can mix up to 6 tones.<TR><TD>2<TD>This is a more complex type of FM, where each resulting tone consists of 3 base tones. Tone 1 is the carrier, tone 2 is the first modulator, and tone 3 is the second modulator. For this type of FM, the two modulators are mixed and then used to modulate the carrier. In this way, each group of 3 tones are mixed and modulated together to create one resulting tone, and these resulting tones are then mixed together to generate the sound. So using this type, you can mix up to 4 resulting tones.<TR><TD>3<TD>This type is a variation on type 3. Again 3 base tones are used to generate one tone. Using this modulation type, the modulator, tone 2, is first modulated by tone 3, then the resulting modulated waveform is used to modulate tone 1, the base carrier. In this way, each group of 3 tones are modulated together to create one resulting tone, and these resulting tones are then mixed together to generate the sound. So using this type, you can mix up to 4 resulting tones.<TR><TD>4<TD>This is the most complex FM mode. This mode requires 4 base tones to generate one tone. The first tone is the carrier, the second tone is modulated by the third tone, and the third tone is modulated by the fourth tone. The result is then used to modulate the carrier. In this way, each group of 4 tones are modulated together to create one resulting tone, and these resulting tones are then mixed together to generate the sound. So using this type, you can mix up to 3 resulting tones.</TABLE><P> The loop count plays a sound multiple times. This is useful for creating groups of short tone bursts. This value specifies the number of times to repeat the sound after it's played once. So specify 0 to play the sound just once, specify 1 to repeat it once, and so on.<P> The frequency is specified in Hz, and is a fixed point real number constructed from two fields: the integer part and the fractional part. For example, if you specify 340 for the integer part and 2 for the fractional part, the codec generates a tone of 340.2 Hz.<P> The time values used to play a tone are collectively referred to as the tone <B>envelope</B>, illustrated in <A HREF=#MARKER-9-123>Figure 7-4</A>.<P><B>Figure 7-4  <A NAME=MARKER-9-123></A>Tone envelope</B><P><IMG ALIGN = BOTTOM SRC = "graphics/SndEnvlp.jpg"><BR><BR> All time values specified in the synthesizer data are in milliseconds (1000 ms. = 1 second). There are four time values that make up a tone envelope: attack, decay, sustain, and release. In <A HREF=#MARKER-9-123>Figure 7-4</A>, two additional values, leading silence and trailing silence, are also shown.<P> Attack is the time in which the tone ramps in amplitude from 0 to the peak amplitude. Decay is the time in which the tone ramps from the peak amplitude to the sustain amplitude. Sustain is the time which the tone remains at the sustain amplitude. Finally, release is the time in which the tone amplitude drops from the sustain amplitude to 0.<P> All of the times except sustain can be 0. This means, for example, that a tone would leap from 0 amplitude to the sustain amplitude and then from the sustain amplitude to 0 at the end, with no ramp. All ramps are linear.<P> The leading silence and trailing silence values simply specify a period of silence before or after the sound plays. This is useful when mixing multiple tones and you want a delay in the start of one of the tones, or a delay in the finish when looping is used.<P> The peak amplitude and sustain amplitude are used at two different points in the tone envelope, as shown in <A HREF=#MARKER-9-123>Figure 7-4</A>. The maximum amplitude is 32768; anything above that is clipped. The complexity is that if you are mixing (adding) two or more sine waves, then you must limit the total amplitude to 32768 to avoid clipping. Note that you can specify higher amplitude values, resulting in clipping distortion, which is sometimes a desirable part of the sound.<P></BLOCKQUOTE><HR><center><A HREF="NPG2-278.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-280.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><center><font size=-1><A HREF="NPG2-3.html">&copy; Apple Computer, Inc.</A><br>26 APR 1997<P><!--------------------------- Navigation Area ----------------------------------><BR><!-- Navigation Area --><BR><A HREF="reference to server cgi goes here"><IMG BORDER="0" SRC="../../../../images/nav.gif" WIDTH="500" HEIGHT="32" ALT="Navigation graphic, see text links" ISMAP USEMAP="#nav"></A><BR><P><A HREF="../../../../devworld.shtml">Main</A> | <A HREF="../../techinfo.html">Top of Section</A> | <A HREF="../../newtondev.shtml#WhatsNew">What's New</A> | <A HREF="http://www.apple.com/">Apple Computer, Inc.</A> |<A HREF="../../../../find.html">Find It</A> | <A HREF="../../feedback.html">Feedback</A> | <A HREF="../../../../help.html">Help</A></FONT><P></CENTER><!-- Don't forget to add the necessary links for each of these items. --><BR><MAP NAME="nav"><!-- client side map for www.apple.com nav.gif --><!-- Main --><AREA SHAPE="RECT" COORDS="9,6,70,25" HREF="../../../../devworld.shtml"><!-- Page One --><AREA SHAPE="RECT" COORDS="80,6,142,25" HREF="../../techinfo.html"><!-- What's New --><AREA SHAPE="RECT" COORDS="150,5,211,25" HREF="../../newtondev.shtml#WhatsNew"><!-- Apple Logo --><AREA SHAPE="RECT" COORDS="220,6,280,25" HREF="http://www.apple.com/"><!-- Find It --><AREA SHAPE="RECT" COORDS="290,5,350,26" HREF="../../../../find.html"><!-- Contact Us --><AREA SHAPE="RECT" COORDS="361,5,422,25" HREF="../../feedback.html"><!-- Help --><AREA SHAPE="RECT" COORDS="430,5,492,25" HREF="../../../../help.html"><!-- DEFAULT AREA NOT SUPPORTED BY CLIENT SIDE IMAGEMAPS! --></MAP><P></BODY></HTML> 