<!-- Generated by Harlequin WebMaker 2.3.1 (16-Oct-1996)Macintosh Common Lisp Version 4.0 --><HTML> <HEAD><TITLE>Handling Command Keys</TITLE></HEAD><BODY><A NAME=HEADING169></A><CENTER>     <IMG BORDER="0" SRC="../../../../images/level3.gif" ALT="Title Banner"      ISMAP USEMAP="#level3">     <BR>     <MAP NAME="level3">     <!-- Find It -->     <AREA SHAPE="RECT" COORDS="7, 9, 69, 30" HREF="../../../../find.html">     <!-- Main -->     <AREA SHAPE="RECT" COORDS="432, 9, 492, 30" HREF="../../../../devworld.shtml">     </MAP><P><A HREF="NPG2-168.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-170.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><FONT SIZE=-1><DL><DT><A HREF="../../techinfo.html"><B>Newton Developer Technical Information:</B></A> <A HREF="NPG2-2.html"><B>Newton Programmer's Guide: 2.1 OS Addendum</B></A> / <BR><DD><A HREF="NPG2-159.html"><B>Chapter 4 - Keyboard Enhancements</B></A> / <A HREF="NPG2-167.html"><B>Using the Keyboard Enhancements</B></A></DL></FONT><P><HR><BLOCKQUOTE><A NAME=HEADING169-0></A><H2><A NAME=MARKER-9-31></A>Handling Command Keys</H2> Each view in your application can have a set of key commands associated with it. You can use the functions and methods shown in <A HREF=#MARKER-9-4>Table 4-11</A> to work with key commands.<p><B>Table 4-11  <A NAME=MARKER-9-4></A>Summary of command key methods and functions </B><TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Function/Method<TH>Description<TR><TD><I>view<CODE>:AddKeyCommand</CODE></I><TD>Adds a key command to a view.<TR><TD><I>view<CODE>:AddKeyCommands</CODE></I><TD>Adds an array of key commands to a view.<TR><TD><I>view<CODE>:BlockKeyCommand</CODE></I><TD>Blocks a key command from being associated with a view.<TR><TD><I>view<CODE>:ClearKeyCommands</CODE></I><TD>Removes all key commands from a view.<TR><TD><I>view<CODE>:<BR>RemoveKeyCommandFrame</CODE></I><TD>Removes a specific key command frame from a view.<TR><TD><CODE>SendKeyMessage</CODE><TD>Sends a key message as if a key command had been typed on the keyboard.<TR><TD><CODE>FindKeyCommand</CODE><TD>Finds the key command that matches a command-key combination.<TR><TD><CODE>GatherKeyCommands</CODE><TD>Returns an array of the command keys associated with a view.</TABLE><P><A NAME=HEADING169-2></A><H3>Searching for Key Commands</H3> If your <A HREF=NPG2-192.html#MARKER-9-67><EM>*</EM></A><CODE>ViewKeyDownScript</CODE> or <A HREF=NPG2-194.html#MARKER-9-71><EM>*</EM></A><CODE>ViewKeyRepeatScript</CODE> methods return <CODE>nil</CODE>, the system tests for a key command by searching for a <CODE>keyCommand</CODE> frame that matches the entered key(s). By default, the system searches for a <CODE>keyCommand</CODE> frame when the the user presses a function key, the escape key, or any key in combination with the command key. You can also force the system to search for key commands after each keystroke by setting the <CODE>vAlwaysTryKeyCommands</CODE> text flag in the key view.<P><A NAME=HEADING169-4></A><H3>Defining Key Commands</H3> To define a set of key commands, you need to create an array of <CODE>keyCommand</CODE> frames, each of which defines an individual key command. See <A HREF=NPG2-175.html#MARKER-9-38>&quot;The Command-Key Mapping Frame&quot;</A> for a full description of the <CODE>keyCommand</CODE> frame slots. <A HREF=#MARKER-9-32>Listing 4-2</A> shows an example of a key command array.<P><B>Listing 4-2  <A NAME=MARKER-9-32></A>A key command array</B><P><PRE><P> keyCommandArray:<P>   [      {         char: $g,         modifiers:kCommandModifier,         keyMessage:'DoGKeyCommand,         name: &quot;Do G Key&quot;,      },      {         char: $b,         modifiers:kCommandModifier,         keyMessage:'DoBKeyCommand,         name: &quot;Do B Key&quot;,      },    ],<P><P></PRE> Each <CODE>keyCommand</CODE> frame specifies the keys that the user presses to invoke the command, the name to display for the command, and the message that the system sends when the command is invoked. <P><A NAME=HEADING169-23></A><H4>Adding the Key-Commands</H4> You can use the <A HREF=NPG2-181.html#MARKER-9-47><EM>*</EM></A><CODE>AddKeyCommand</CODE> method of a view to add a single key-command, or you can use the <A HREF=NPG2-182.html#MARKER-9-49><EM>*</EM></A><CODE>AddKeyCommands</CODE> method to add an array of key-commands to the view. You typically add your key-commands during view setup. <A HREF=#MARKER-9-33>Listing 4-3</A> shows an example of setting up key-commands in the <CODE>ViewSetupFormScript</CODE> method.<P><B>Listing 4-3  <A NAME=MARKER-9-33></A>Defining key-commands in the <CODE>ViewSetupFormScript</CODE> method</B><P><PRE>ViewSetupFormScript: func()   begin   :AddKeyCommands( keyCommandArray );   end</PRE> Note that the most recently added key command for a specific key combination takes precedence. If, for example, your application defines a Cmd-F equivalent and adds it using <A HREF=NPG2-181.html#MARKER-9-47><EM>*</EM></A><CODE>AddKeyCommand</CODE>, and then adds another Cmd-F equivalent, the last one added will be the only one seen by the system.<P><A NAME=HEADING169-31></A><H4>Invoking the Command-Key Method</H4> When the user presses a command-key combination, the system software sends the message associated with the command key (as defined in its <CODE>keyCommand</CODE> frame). The method that is invoked for the command-key message need not be implemented in the same view as is the command key.<P> Once the system software matches a <CODE>keyCommand</CODE>, the system searches the same chain (starting at the key-view and following either <CODE>_parent</CODE> or <CODE>_nextKeyView</CODE> slots) until the method has been found. The method is called with a single parameter: the current key-view. For example, if the key commands array shown in <A HREF=#MARKER-9-32>Listing 4-2</A> is in use and the user presses the <CODE>Cmd-g</CODE> key-combination, the following call is made:<P><PRE><P> view:DoGKeyCommand(currentKeyView)<P></PRE> You can examine the current key-view in your implementation to decide which actions you want to take in your method implementation.<P><A NAME=HEADING169-36></A><H4>Removing Key-Commands</H4> It is good practice to remove your key-commands when your view is closing. To do so, you can call the <A HREF=NPG2-186.html#MARKER-9-57><EM>*</EM></A><CODE>ClearKeyCommands</CODE> method in the <CODE>ViewQuitScript</CODE> method of your view. <A HREF=#MARKER-9-34>Listing 4-4</A> shows an example.<P><B>Listing 4-4  <A NAME=MARKER-9-34></A>Removing key-commands</B><P><PRE>ViewQuitScript: func()   begin   :ClearKeyCommands();   inherited:?ViewQuitScript();   end</PRE><DL><DT><B>Note</B><DD>If you do not remove key commands when your view is closing, the key commands can waste valuable heap space. <EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif"></DL></BLOCKQUOTE><HR><center><A HREF="NPG2-168.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-170.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><center><font size=-1><A HREF="NPG2-3.html">&copy; Apple Computer, Inc.</A><br>26 APR 1997<P><!--------------------------- Navigation Area ----------------------------------><BR><!-- Navigation Area --><BR><A HREF="reference to server cgi goes here"><IMG BORDER="0" SRC="../../../../images/nav.gif" WIDTH="500" HEIGHT="32" ALT="Navigation graphic, see text links" ISMAP USEMAP="#nav"></A><BR><P><A HREF="../../../../devworld.shtml">Main</A> | <A HREF="../../techinfo.html">Top of Section</A> | <A HREF="../../newtondev.shtml#WhatsNew">What's New</A> | <A HREF="http://www.apple.com/">Apple Computer, Inc.</A> |<A HREF="../../../../find.html">Find It</A> | <A HREF="../../feedback.html">Feedback</A> | <A HREF="../../../../help.html">Help</A></FONT><P></CENTER><!-- Don't forget to add the necessary links for each of these items. --><BR><MAP NAME="nav"><!-- client side map for www.apple.com nav.gif --><!-- Main --><AREA SHAPE="RECT" COORDS="9,6,70,25" HREF="../../../../devworld.shtml"><!-- Page One --><AREA SHAPE="RECT" COORDS="80,6,142,25" HREF="../../techinfo.html"><!-- What's New --><AREA SHAPE="RECT" COORDS="150,5,211,25" HREF="../../newtondev.shtml#WhatsNew"><!-- Apple Logo --><AREA SHAPE="RECT" COORDS="220,6,280,25" HREF="http://www.apple.com/"><!-- Find It --><AREA SHAPE="RECT" COORDS="290,5,350,26" HREF="../../../../find.html"><!-- Contact Us --><AREA SHAPE="RECT" COORDS="361,5,422,25" HREF="../../feedback.html"><!-- Help --><AREA SHAPE="RECT" COORDS="430,5,492,25" HREF="../../../../help.html"><!-- DEFAULT AREA NOT SUPPORTED BY CLIENT SIDE IMAGEMAPS! --></MAP><P></BODY></HTML> 