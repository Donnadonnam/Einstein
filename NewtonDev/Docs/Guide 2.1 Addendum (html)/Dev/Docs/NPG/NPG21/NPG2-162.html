<!-- Generated by Harlequin WebMaker 2.3.1 (16-Oct-1996)Macintosh Common Lisp Version 4.0 --><HTML> <HEAD><TITLE>About Keystroke Handling</TITLE></HEAD><BODY><A NAME=HEADING162></A><CENTER>     <IMG BORDER="0" SRC="../../../../images/level3.gif" ALT="Title Banner"      ISMAP USEMAP="#level3">     <BR>     <MAP NAME="level3">     <!-- Find It -->     <AREA SHAPE="RECT" COORDS="7, 9, 69, 30" HREF="../../../../find.html">     <!-- Main -->     <AREA SHAPE="RECT" COORDS="432, 9, 492, 30" HREF="../../../../devworld.shtml">     </MAP><P><A HREF="NPG2-161.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-163.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><FONT SIZE=-1><DL><DT><A HREF="../../techinfo.html"><B>Newton Developer Technical Information:</B></A> <A HREF="NPG2-2.html"><B>Newton Programmer's Guide: 2.1 OS Addendum</B></A> / <BR><DD><A HREF="NPG2-159.html"><B>Chapter 4 - Keyboard Enhancements</B></A> / <A HREF="NPG2-160.html"><B>About Keyboard Enhancements</B></A></DL></FONT><P><HR><BLOCKQUOTE><A NAME=HEADING162-0></A><H2>About Keystroke Handling</H2> This section provides general information about how keystrokes are handled by the system software and how your application can intercept keystrokes, including the following techniques:<P><UL><LI>When you need to apply custom handling to keyboard events, you can intercept those events, including the key-down, key-up, and key-repeat events. <LI>Sometimes the system groups multiple keystrokes together into keystrings to improve performance. You can also intercept these strings, which are used to improve user response time. Note that rapid successions of keystrokes in all views are grouped together into strings unless you set the <CODE>vSingleKeystrokes</CODE> text flag in the view.<BR><BR>For example, if the user quickly types the word "something" into a long paragraph view, each change to the view's contents results in an insertion and redisplay. Grouping the keys into a single insertion and redisplay operation produces a much faster response than responding individually to the entry of each character.<LI>You can define keyboard commands (command keys) that the system will match and execute where appropriate. </UL><A NAME=HEADING162-5></A><H3><A NAME=MARKER-9-19></A>Keystroke Event Sequencing</H3> This section describes the sequence of events that is generated when the user presses, holds down, and then releases a key on the keyboard. <P><A NAME=HEADING162-7></A><H4>Key-down Events</H4> The following list describes the processing sequence when the user presses down on a keyboard key and a key-down event is generated:<P><OL><LI>If the <CODE>vSingleKeystrokes</CODE> text flag is set in the key-view, the view system looks for a <A HREF=NPG2-192.html#MARKER-9-67><EM>*</EM></A><CODE>ViewKeyDownScript</CODE> method in the key-view (proto inheritance only) and calls it. Note that the <A HREF=NPG2-192.html#MARKER-9-67><EM>*</EM></A><CODE>ViewKeyDownScript</CODE> method is also called when there are no other pending, unprocessed keystrokes.<LI>If the <A HREF=NPG2-192.html#MARKER-9-67><EM>*</EM></A><CODE>ViewKeyDownScript</CODE> method returns a non-<CODE>nil</CODE> value, handling for the key-down event is complete.<LI>Otherwise, the system checks for a command key. This is described in detail in <A HREF=NPG2-169.html#MARKER-9-31>&quot;Handling Command Keys&quot;</A>.<LI>If the key is not a command key, the default view class handling occurs. If the key-view is a <CODE>clEditView</CODE>, a new paragraph is created at the caret location. If the key-view is a <CODE>clParagraphView</CODE>, the default handling is to insert the appropriate character at the caret, unless the key is a backspace or arrow key, in which case the expected action occurs. Note that if the user is typing in an existing paragraph in an edit view, the paragraph receives the key strokes.</OL><A NAME=HEADING162-13></A><H4>Key-repeat Events</H4> The following list describes the processing sequence when the user holds down a keyboard key and key-repeat events are generated:<P><OL><LI>After a brief delay, the system starts issuing key-repeat events. <LI>For each key-repeat event, if <CODE>vSingleKeystrokes</CODE> is set in the key-view, the system calls <A HREF=NPG2-194.html#MARKER-9-71><EM>*</EM></A><CODE>ViewKeyRepeatScript</CODE> (proto inheritance only) is called.<LI>If the view does not have a <A HREF=NPG2-194.html#MARKER-9-71><EM>*</EM></A><CODE>ViewKeyRepeatScript</CODE>, the system calls <CODE><A HREF=NPG2-192.html#MARKER-9-67><EM>*</A>ViewKeyDownScript </EM></CODE>instead. <LI>If this method returns non-<CODE>nil</CODE>, the repeated keystroke is considered to have been handled. <LI>Otherwise, the system checks for a command key , as described later in this section. Commands can specify whether or not they are executed with repeated keys.<LI>If the key is not a command key, the default view class handling occurs. </OL><A NAME=HEADING162-21></A><H4>Key-release Events</H4> The following list describes the processing sequence when the user releases a keyboard key and a key-up event is generated:<P><OL><LI>If <CODE>vSingleKeystrokes</CODE> is set in the key-view, the view system the <CODE><A HREF=NPG2-193.html#MARKER-9-69><EM>*</A>ViewKeyUpScript</EM></CODE> (proto inheritance only) is called.<LI>If the <A HREF=NPG2-193.html#MARKER-9-69><EM>*</EM></A><CODE>ViewKeyUpScript</CODE> returns a non-<CODE>nil</CODE> value, the key-up event handling is complete.<LI>No command check occurs with key-up events.<LI>Otherwise, the default view class handling occurs. Ordinarily, this is nothing at all -- all characters are inserted at key-down time, and arrows and tabs are handled then as well. The exception is the backspace key when the last paragraph of a paragraph has been deleted: the default key-up handler for a <CODE>clParagraphView</CODE> will remove the view from its parent if that view is inside a <CODE>clEditView</CODE>.</OL><A NAME=HEADING162-27></A><H3>Typing Without a Caret</H3> The key-view must be established before a keystroke is posted. This means that when the user types and there is not an active caret (the key-view is <CODE>nil</CODE>), the system has to set the key-view. However, different actions need to be taken, depending on whether the keystroke is a command key or an insertable character key.<P> When a key is pressed and the key-view is <CODE>nil</CODE>, the system looks for the frontmost view that can handle it. This view may vary, depending on whether or not the key pressed is a command key. <P></BLOCKQUOTE><HR><center><A HREF="NPG2-161.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-163.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><center><font size=-1><A HREF="NPG2-3.html">&copy; Apple Computer, Inc.</A><br>26 APR 1997<P><!--------------------------- Navigation Area ----------------------------------><BR><!-- Navigation Area --><BR><A HREF="reference to server cgi goes here"><IMG BORDER="0" SRC="../../../../images/nav.gif" WIDTH="500" HEIGHT="32" ALT="Navigation graphic, see text links" ISMAP USEMAP="#nav"></A><BR><P><A HREF="../../../../devworld.shtml">Main</A> | <A HREF="../../techinfo.html">Top of Section</A> | <A HREF="../../newtondev.shtml#WhatsNew">What's New</A> | <A HREF="http://www.apple.com/">Apple Computer, Inc.</A> |<A HREF="../../../../find.html">Find It</A> | <A HREF="../../feedback.html">Feedback</A> | <A HREF="../../../../help.html">Help</A></FONT><P></CENTER><!-- Don't forget to add the necessary links for each of these items. --><BR><MAP NAME="nav"><!-- client side map for www.apple.com nav.gif --><!-- Main --><AREA SHAPE="RECT" COORDS="9,6,70,25" HREF="../../../../devworld.shtml"><!-- Page One --><AREA SHAPE="RECT" COORDS="80,6,142,25" HREF="../../techinfo.html"><!-- What's New --><AREA SHAPE="RECT" COORDS="150,5,211,25" HREF="../../newtondev.shtml#WhatsNew"><!-- Apple Logo --><AREA SHAPE="RECT" COORDS="220,6,280,25" HREF="http://www.apple.com/"><!-- Find It --><AREA SHAPE="RECT" COORDS="290,5,350,26" HREF="../../../../find.html"><!-- Contact Us --><AREA SHAPE="RECT" COORDS="361,5,422,25" HREF="../../feedback.html"><!-- Help --><AREA SHAPE="RECT" COORDS="430,5,492,25" HREF="../../../../help.html"><!-- DEFAULT AREA NOT SUPPORTED BY CLIENT SIDE IMAGEMAPS! --></MAP><P></BODY></HTML> 