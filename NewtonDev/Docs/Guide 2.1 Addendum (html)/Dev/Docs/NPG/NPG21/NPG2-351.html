<!-- Generated by Harlequin WebMaker 2.3.1 (16-Oct-1996)Macintosh Common Lisp Version 4.0 --><HTML> <HEAD><TITLE>Making a Connection</TITLE></HEAD><BODY><A NAME=HEADING351></A><CENTER>     <IMG BORDER="0" SRC="../../../../images/level3.gif" ALT="Title Banner"      ISMAP USEMAP="#level3">     <BR>     <MAP NAME="level3">     <!-- Find It -->     <AREA SHAPE="RECT" COORDS="7, 9, 69, 30" HREF="../../../../find.html">     <!-- Main -->     <AREA SHAPE="RECT" COORDS="432, 9, 492, 30" HREF="../../../../devworld.shtml">     </MAP><P><A HREF="NPG2-350.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-352.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><FONT SIZE=-1><DL><DT><A HREF="../../techinfo.html"><B>Newton Developer Technical Information:</B></A> <A HREF="NPG2-2.html"><B>Newton Programmer's Guide: 2.1 OS Addendum</B></A> / <BR><DD><A HREF="NPG2-346.html"><B>Chapter 9 - IrDA Communication Tool</B></A> / <A HREF="NPG2-350.html"><B>Using the IrDA Tool</B></A></DL></FONT><P><HR><BLOCKQUOTE><A NAME=HEADING351-0></A><H2>Making a Connection</H2> Establishing a connection with an IrDA device is a multi-staged process. The first stage of the connection process is the discovery phase. In this stage, the Newton unit probes and accumulates a list of other IrDA devices within beaming range. Each device is loosely identified by a service hints field (PDA/Computer/Printer/etc) and a device nickname. The <A HREF=NPG2-355.html#MARKER-9-26><EM>*</EM></A>kCMOIrDADiscoveryInformation option is used to specify which device to use and also how the Newton unit should appear to other devices that probe it (in a <CODE>Listen</CODE> operation).<P> The second stage of the connection process involves a name lookup of the service to use, or registry of the service provided (in a <CODE>Listen</CODE> operation). The <A HREF=NPG2-356.html#MARKER-9-29><EM>*</EM></A>kCMOIrDAConnectInformation option is used to specify this information.<P> The final stage of the connection process is to make the connection. At this point, a negotiation phase takes place between the Newton unit and the other IrDA device. The negotiation parameters are baud rate, data size (receive buffer size), window size (number of receive buffers), and link disconnect time. The following options are used to define these negotiation parameters: <CODE>kCMOSerialBitRate</CODE>, <A HREF=NPG2-357.html#MARKER-9-32><EM>*</EM></A><CODE>kCMOIrDAReceiveBuffers</CODE>, and <CODE><A HREF=NPG2-358.html#MARKER-9-34><EM>*</A>kCMOIrDALinkDisconnectTimeout</EM></CODE>.<P> Note that the <CODE>kCMOSerialBitRate</CODE> option is not documented in this chapter because it's already covered in the "Built-in Communications Tools" chapter of <I>Newton Programmer's Reference</I>. It works slightly different when used with the IrDA tool; it specifies the maximum speed at which you want the Newton device to communicate. The value you specify can be negotiated downwards by the device at the other end of the connection. The default value for the IrDA tool is <CODE>k115200bps</CODE>, or 115200 bits per second.<P> For convenience and future compatibility, the known higher FIR speeds defined for IrDA of 576000, 1152000, and 4000000 bps are accepted but treated as <CODE>k115200bps</CODE> (the highest possible speed currently supported by the hardware).<P> Below is an example NewtonScript option array that specifies all the options that can be used with either a <CODE>Connect</CODE> or <CODE>Listen</CODE> request. Note that some fields of some options apply only to <CODE>Connect</CODE> while other fields apply only to <CODE>Listen</CODE>.<P> Typically, the only option that needs to be supplied is the <A HREF=NPG2-356.html#MARKER-9-29><EM>*</EM></A>kCMOIrDAConnectInformation option, to either identify the Newton device or to identify the device that you are connecting to. And even this option may be omitted if two Newton devices are communicating peer to peer, since they both use the default connection names.<P><PRE><P> fEndpointConnectOptions := [<P>{  label:  kCMOIrDADiscoveryInformation, // IrDA discovery information   type:   'option,   opCode: opSetRequired,   data: {      arglist: [         8,         kIrDASvcHintPDAPalmtop,         kIrDASvcHintPrinter,         0,         1,      ],      typelist: [         'struct,         'uLong, // num probe slots, default is 8         'uLong, // my service hint, default is PDA         'uLong, // service hint mask         'uLong, // returned devAddr of peer device         'uLong, // use standard media busy check?      ],    },},{  label: kCMOIrDAConnectInformation, // IrDA connect info   type:   'option,   opCode: opSetRequired,   data: {      arglist: [         0,         0,         4, // e.g. strlen(&quot;Test&quot;)         5, // e.g. strlen(&quot;IrLPT&quot;)         &quot;Test&quot;,         &quot;IrLPT&quot;,      ],      typelist: [         'struct,         'uLong, // my lsap id, default is 0         'uLong, // peer lsap id, default is 0         'uLong, // my name length, default is 1         'uLong, // peer name length, default is 1         ['array, 'char, 0], // my name, default is &quot;X&quot;         ['array, 'char, 0], // peer name, default is &quot;X&quot;      ],    },},<CODE>{  label:  kCMOSerialBitRate</CODE>, // serial bit rate   type:   'option,   opCode: opSetRequired,   data: {      arglist: [         115200,      ],      typelist: [         'struct,         'uLong, // max negotiate speed, default is 115.2k      ],    },},<CODE>{  label:  kCMOIrDAReceiveBuffers</CODE>, // IrDA recv buffers info   type:   'option,   opCode: opSetRequired,   data: {      arglist: [         2048,         1,      ],      typelist: [         'struct,         'uLong, // size of each receive buffer, default is 512         'uLong, // number of receive buffers used, default is 1      ],    },},<CODE>{  label:  kCMOIrDALinkDisconnectTimeout</CODE>, // link disconnect threshold   type:   'option,   opCode: opSetRequired,   data: {      arglist: [         8,      ],      typelist: [         'struct,         uLong, // time before disconnect, default is 40 seconds      ],    },}, ];<P><P></PRE> If the above example option is used to connect, the Newton limits discovered devices to printers, and connects to the IrDA device with the class name <CODE>&quot;IrLPT&quot;</CODE>. The Newton will communicate (up to) 115.2 Kbps, and will receive data using one 2K buffer. If there is no activity from the peer device, then the Newton will disconnect after 8 seconds.<P> If the above example option is used to listen, the Newton advertises itself as a palmtop device with the class name <CODE>&quot;Test&quot;</CODE>. The Newton will communicate (up to) 115.2 Kbps, and will receive data using one 2K buffer. If there is no activity from the peer device, then the Newton will disconnect after 8 seconds.<P></BLOCKQUOTE><HR><center><A HREF="NPG2-350.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-352.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><center><font size=-1><A HREF="NPG2-3.html">&copy; Apple Computer, Inc.</A><br>26 APR 1997<P><!--------------------------- Navigation Area ----------------------------------><BR><!-- Navigation Area --><BR><A HREF="reference to server cgi goes here"><IMG BORDER="0" SRC="../../../../images/nav.gif" WIDTH="500" HEIGHT="32" ALT="Navigation graphic, see text links" ISMAP USEMAP="#nav"></A><BR><P><A HREF="../../../../devworld.shtml">Main</A> | <A HREF="../../techinfo.html">Top of Section</A> | <A HREF="../../newtondev.shtml#WhatsNew">What's New</A> | <A HREF="http://www.apple.com/">Apple Computer, Inc.</A> |<A HREF="../../../../find.html">Find It</A> | <A HREF="../../feedback.html">Feedback</A> | <A HREF="../../../../help.html">Help</A></FONT><P></CENTER><!-- Don't forget to add the necessary links for each of these items. --><BR><MAP NAME="nav"><!-- client side map for www.apple.com nav.gif --><!-- Main --><AREA SHAPE="RECT" COORDS="9,6,70,25" HREF="../../../../devworld.shtml"><!-- Page One --><AREA SHAPE="RECT" COORDS="80,6,142,25" HREF="../../techinfo.html"><!-- What's New --><AREA SHAPE="RECT" COORDS="150,5,211,25" HREF="../../newtondev.shtml#WhatsNew"><!-- Apple Logo --><AREA SHAPE="RECT" COORDS="220,6,280,25" HREF="http://www.apple.com/"><!-- Find It --><AREA SHAPE="RECT" COORDS="290,5,350,26" HREF="../../../../find.html"><!-- Contact Us --><AREA SHAPE="RECT" COORDS="361,5,422,25" HREF="../../feedback.html"><!-- Help --><AREA SHAPE="RECT" COORDS="430,5,492,25" HREF="../../../../help.html"><!-- DEFAULT AREA NOT SUPPORTED BY CLIENT SIDE IMAGEMAPS! --></MAP><P></BODY></HTML> 