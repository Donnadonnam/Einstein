<!-- Generated by Harlequin WebMaker 2.3.1 (16-Oct-1996)Macintosh Common Lisp Version 4.0 --><HTML> <HEAD><TITLE>Keystroke Handling</TITLE></HEAD><BODY><A NAME=HEADING168></A><CENTER>     <IMG BORDER="0" SRC="../../../../images/level3.gif" ALT="Title Banner"      ISMAP USEMAP="#level3">     <BR>     <MAP NAME="level3">     <!-- Find It -->     <AREA SHAPE="RECT" COORDS="7, 9, 69, 30" HREF="../../../../find.html">     <!-- Main -->     <AREA SHAPE="RECT" COORDS="432, 9, 492, 30" HREF="../../../../devworld.shtml">     </MAP><P><A HREF="NPG2-167.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-169.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><FONT SIZE=-1><DL><DT><A HREF="../../techinfo.html"><B>Newton Developer Technical Information:</B></A> <A HREF="NPG2-2.html"><B>Newton Programmer's Guide: 2.1 OS Addendum</B></A> / <BR><DD><A HREF="NPG2-159.html"><B>Chapter 4 - Keyboard Enhancements</B></A> / <A HREF="NPG2-167.html"><B>Using the Keyboard Enhancements</B></A></DL></FONT><P><HR><BLOCKQUOTE><A NAME=HEADING168-0></A><H2><A NAME=MARKER-9-29></A>Keystroke Handling</H2> This section describes how to handle keystrokes in your Newton applications. <A HREF=#MARKER-9-1>Table 4-9</A> shows the functions and methods that you can use to handle keystrokes.<p><B>Table 4-9  Summary of keystroke-handling methods and functions<A NAME=MARKER-9-1></A></B><TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Function/Method<TH>Description<TR><TD><CODE>IsCommandKeystroke</CODE><TD>Determines if a keystroke is a command key combination.<TR><TD><CODE>ViewKeyDownScript</CODE><TD>Sent to the key-view when the user presses a key.<TR><TD><CODE>ViewKeyUpScript</CODE><TD>Sent to the key-view when the user releases a key.<TR><TD><CODE>ViewKeyStringScript</CODE><TD>Sent to the key-view when a group of keystrokes needs to be processed. This can occur when single keystroke handling is not applied to the key-view (when the <CODE>vSingleKeystrokes</CODE> flag is not set.<TR><TD><CODE>ViewKeyRepeatScript</CODE><TD>Sent to the key-view while the user holds a key down.</TABLE><P><A NAME=HEADING168-2></A><H3>Intercepting Keystrokes Directly</H3> To intercept keystrokes directly, you need to respond to the key-down, key-repeat, and key-up events. If you set the <CODE>vSingleKeystrokes</CODE> text flag for your view, you are guaranteed that the scripts for these key events are called for every keystroke. If you do not set the <CODE>vSingleKeystrokes</CODE> text flag for your view, the scripts are called only under certain circumstances.<P><DL><DT><B>Note</B><DD>Setting the <CODE>vSingleKeystrokes</CODE> text flag in a paragraph view results in a substantial reduction in typing performance for the user. This is because the system processes each keystroke individually, rather than batching a set of keystrokes into a string.  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif"></DL> The system software calls a method for each of the keyboard events. For an overview of the sequencing of actions when the user presses keys, see <A HREF=NPG2-162.html#MARKER-9-19>&quot;Keystroke Event Sequencing&quot;</A>. If the method returns <CODE>nil</CODE> (to indicate that the system should continue processing the key event), the system next checks the key to determine if it is a command key. If the event is not a command key, the system hands the key event to the appropriate view for default handling.<P> The functions and event scripts for handling keystrokes are shown in <A HREF=#MARKER-9-1>Table 4-9</A>; their use is described in the remainder of this section.<P><A NAME=HEADING168-8></A><H3>Intercepting Individual Keystrokes</H3> Here is an example of code that processes individual keystrokes.<P><PRE><P> <A NAME=MARKER-10-30></A>ViewKeyDownScript: func( char, flags )<P>   begin   if char = unicodeCR then      begin      :OutputTextLine( self.text );      SetValue( self, 'text, &quot;&quot; );      return true;      end;      // Explicitly return nil just for clarity   nil;end;</PRE><A NAME=HEADING168-22></A><H3>Intercepting Grouped Keystrokes</H3> If you have not set the <CODE>vSingleKeystrokes</CODE> flag for the key-view, the system groups together a set of keystrokes (a keystring) for batch processing and sends the <A HREF=NPG2-195.html#MARKER-9-73><EM>*</EM></A><CODE>ViewKeyStringScript</CODE> message when a group of keystrokes is ready to be handled.<P><DL><DT><B>Note</B><DD>Although the system can group keystrokes into keystrings, this only happens when the user is typing at a very high speed. If the system can keep up with individual keystrokes, the keystrokes are not grouped into a keystring. <EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif"></DL><A NAME=HEADING168-26></A><H3>Text Flags and Keyboard Input</H3> Paragraph views, edit views, and text editing views all accept both command keys and normal keys (for insertion). For other views, there are two additional <CODE>textFlags</CODE> that you can use to specify the kinds of keystrokes you want to handle, as shown in <A HREF=#MARKER-9-2>Table 4-10</A>.<p><B>Table 4-10  Text flags to specify the kind of keystrokes a view accepts<A NAME=MARKER-9-2></A></B><TABLE BORDER="0" CELLPADDING=3><TH ALIGN=LEFT>Text Flag<TH>Description<TR><TD>vTakesCommandKeys<TD>The view accepts command keys.<TR><TD>vTakesAllKeys<TD>The view accepts all keys, including command keys.</TABLE><P><DL><DT><B>Note: </B><DD>Do not use the text flags shown in <A HREF=#MARKER-9-2>Table 4-10</A> for edit views, paragraph views, or word-processing (<A HREF=NPG2-117.html#MARKER-9-31><EM>*</EM></A><CODE>protoTXView</CODE>) views, all of which always act as if both flags are on (as long as they are not read-only views). <EM></EM>  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif"></DL> These flags are also significant when a normal key is typed. If a normal key is typed when the key-view accepts only command keys, the key-view is switched to the frontmost view that accepts normal keys.<P> You can determine which view is the frontmost view that accepts normal keystroke by calling <CODE>GetView</CODE> as follows:<P><PRE><P> view := GetView('viewfrontkey);<P></PRE> You can determine which view is the frontmost view that accepts command keystrokes by calling <CODE>GetView</CODE> as follows:<P><PRE><P> view := GetView('viewfrontcommandkey);<P></PRE></BLOCKQUOTE><HR><center><A HREF="NPG2-167.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-169.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><center><font size=-1><A HREF="NPG2-3.html">&copy; Apple Computer, Inc.</A><br>26 APR 1997<P><!--------------------------- Navigation Area ----------------------------------><BR><!-- Navigation Area --><BR><A HREF="reference to server cgi goes here"><IMG BORDER="0" SRC="../../../../images/nav.gif" WIDTH="500" HEIGHT="32" ALT="Navigation graphic, see text links" ISMAP USEMAP="#nav"></A><BR><P><A HREF="../../../../devworld.shtml">Main</A> | <A HREF="../../techinfo.html">Top of Section</A> | <A HREF="../../newtondev.shtml#WhatsNew">What's New</A> | <A HREF="http://www.apple.com/">Apple Computer, Inc.</A> |<A HREF="../../../../find.html">Find It</A> | <A HREF="../../feedback.html">Feedback</A> | <A HREF="../../../../help.html">Help</A></FONT><P></CENTER><!-- Don't forget to add the necessary links for each of these items. --><BR><MAP NAME="nav"><!-- client side map for www.apple.com nav.gif --><!-- Main --><AREA SHAPE="RECT" COORDS="9,6,70,25" HREF="../../../../devworld.shtml"><!-- Page One --><AREA SHAPE="RECT" COORDS="80,6,142,25" HREF="../../techinfo.html"><!-- What's New --><AREA SHAPE="RECT" COORDS="150,5,211,25" HREF="../../newtondev.shtml#WhatsNew"><!-- Apple Logo --><AREA SHAPE="RECT" COORDS="220,6,280,25" HREF="http://www.apple.com/"><!-- Find It --><AREA SHAPE="RECT" COORDS="290,5,350,26" HREF="../../../../find.html"><!-- Contact Us --><AREA SHAPE="RECT" COORDS="361,5,422,25" HREF="../../feedback.html"><!-- Help --><AREA SHAPE="RECT" COORDS="430,5,492,25" HREF="../../../../help.html"><!-- DEFAULT AREA NOT SUPPORTED BY CLIENT SIDE IMAGEMAPS! --></MAP><P></BODY></HTML> 