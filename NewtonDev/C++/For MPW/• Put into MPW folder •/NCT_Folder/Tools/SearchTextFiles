# SearchTextFiles #  written by John Arkley#  November 16, 1995#  Copyright 1995 Apple Computer, Inc.if {TraceFailures} ; Echo "## Beginning SearchTextFiles script" ; 	Echo "# parameters are Ô{1}Õ Ô{2}Õ Ô{3}Õ"end# invoked as a script so it can have parameters#  SearchTextFiles  [-r ] [sopts] ["searchFolder" ["stringtofind"]]#  No param 					:= search current directory non-recursively asking for patterntofind#  -r 							:= search current dir recursively asking for patterntofind#  "Folderpath" 				:= search folder non-recursively asking for patterntofind#  -r "Folderpath" 				:= search folder recurstively asking for patterntofind#  "Folderpath" "pattern"		:= search folder non-recursively for pattern#  -r "Folderpath" "pattern"		:= search folder recurstively for pattern# Exit 0 if "{0}" == ""  # can't execute this script Set _Option-r ""set _recursively_ ""if {#} > 0	if "{1}" == "-r"		Set _Option-r "-r"		set _recursively_ " and all its sub-folders"		Shift	end	if "{1}" == "-help" || "{1}" == "-h"	(	Echo "### stf is an alias for SearchTextFiles - an MPW Script for searching for a text patterns in source trees"		Echo "# Usage - stf [-r] [sopts]  [ folder [ patterntofind] ] ¶n"		Echo "#     -r       look for TEXT files in current directory/folderpath recursively in sub-folders"		Echo "#    sopts     other -xx options to pass to the MPW Search Tool i.e. one or more of Ò-b -i -s -sf -r -qÓ "		Echo "#    folder    path of the folder to find TEXT files in (and its sub-folders if -r given)"		Echo "#                 use Ô:Õ for folder to search the current directory (and its sub-directories)"		Echo "#   pattern    the string or regular expression to attempt to find. "		Echo "#                 enclose pattern in single quotes if it contains a special characters or a regular expression"	)	endendset _SearchOptions_ ""Loop	If {#} > 0		if "{1}" =~ /-?Å/			Set _SearchOptions_ "{SearchOptions}{1} "			Shift		else			Break		end	Else		Break	Endendif {#} > 1	set NCTSearchstring "{{2}}"else	if "`which CoolRequest ³ Dev:Null`" ­ ""		Set NCTSearchString "`Echo -n "{NCTsearchstring}" | CoolRequest -d -t  "Search for what text¶nor¶nregular expression enclosed in Ô¶/Õs?" || Set Status 0`"	else		Echo "### Error {0}: unable to locate the MPW Tool ÒCoolRequestÓ via the MPW commands path"		Exit 1	endendExit 0 If "{{NCTsearchstring}}" == ""if "{1}" == ""	Set NCTsearch-dir "`Directory -q `"else	if "{1}" == '{Active}'		if "{Active}" =~ /(?Å:)¨1?Å/		# extract leadpath from Active			Set NCTsearch-dir "{¨1}"		else			Echo "### Error {0}: unable to extract folder path from Ò{Active}Ó."			Exit 2		end	else		Set NCTsearch-dir "{1}"	endendIF "{NCTSearchResultsFile}"	If "{NCTAlwaysClearSearchResults}"		Echo -n > "{NCTSearchResultsFile}"	End	Open -n "{NCTSearchResultsFile}"	SaveOnClose -n "{NCTSearchResultsFile}"	Set NCTsrch-redir "·· ¶"{NCTSearchResultsFile}¶""ELSE If "{NCTSendSearchResultsToWorksheet}"	Set NCTsrch-redir "·· ¶"{Worksheet}¶""ELSE	Set NCTsrch-redir ""ENDif "{NCTsearch-dir}" ­ '{NCT_ProjectsList}'	Set NCTTEXTFileList "`files -o -f -t TEXT {_Option-r} "{NCTsearch-dir}"`"	if "{NCTTEXTFileList}" ­ ""		( Echo "### Searching Ò{NCTsearch-dir}Ó{_recursively_} for Ô{{NCTsearchstring}}Õ." 		  Quote Search {_SearchOptions_}-nf -w -e "{{NCTsearchstring}}" {NCTTEXTFileList} 		  Search {_SearchOptions_}-nf -w -e "{{NCTSearchstring}}" {NCTTEXTFileList} || Set Status 0 		) {NCTsrch-redir}	else		Echo "### No ÔTEXTÕ files were found in the search path." {NCTsrch-redir}	endelse	Set NCTsearch-dir "{NCTSources}"	Exit 0 if "{{NCT_ProjectsList}}" == ""	for _proj_dir_ in {NCT_ProjectsList}		Set NCTTEXTFileList "`files -o -f -t TEXT {_Option-r} "{NCTsearch-dir}{_proj_dir_}"`"		if "{NCTTEXTFileList}" ­ ""			( Echo "### Searching Ò{_proj_dir_}Ó{_recursively_} for Ô{{NCTsearchstring}}Õ." 			  Quote Search {_SearchOptions_}-nf -w -e "{{NCTsearchstring}}" {NCTTEXTFileList} 			  Search {_SearchOptions_}-nf -w -e "{{NCTSearchstring}}" {NCTTEXTFileList} || Set Status 0 			) {NCTsrch-redir}		else			Echo "### No ÔTEXTÕ files were found in the path Ò{NCTsearch-dir}{_dir}Ó." {NCTsrch-redir}		end		Set NCTTEXTFileList ""	end	unset _proj_dir_end