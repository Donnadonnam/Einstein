<!-- Generated by Harlequin WebMaker 2.3.1 (16-Oct-1996)Macintosh Common Lisp Version 4.0 --><HTML> <HEAD><TITLE>Adding Custom Drawing Tools</TITLE></HEAD><BODY><A NAME=HEADING50></A><CENTER>     <IMG BORDER="0" SRC="../../../../images/level3.gif" ALT="Title Banner"      ISMAP USEMAP="#level3">     <BR>     <MAP NAME="level3">     <!-- Find It -->     <AREA SHAPE="RECT" COORDS="7, 9, 69, 30" HREF="../../../../find.html">     <!-- Main -->     <AREA SHAPE="RECT" COORDS="432, 9, 492, 30" HREF="../../../../devworld.shtml">     </MAP><P><A HREF="NPG2-49.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-51.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><FONT SIZE=-1><DL><DT><A HREF="../../techinfo.html"><B>Newton Developer Technical Information:</B></A> <A HREF="NPG2-2.html"><B>Newton Programmer's Guide: 2.1 OS Addendum</B></A> / <BR><DD><A HREF="NPG2-45.html"><B>Chapter 2 - Newton Works Draw Application</B></A> / <A HREF="NPG2-49.html"><B>Using the Drawing Application Interface</B></A></DL></FONT><P><HR><BLOCKQUOTE><A NAME=HEADING50-0></A><H2><A NAME=MARKER-9-3></A>Adding Custom Drawing Tools</H2> You can add tools to the Draw application. These tools allow the user to create new types of draw objects. Note that in many cases, it makes more sense to create new graphic objects as bitmaps via the stamp interface; see <A HREF=NPG2-52.html#MARKER-9-7>&quot;Adding Stamps to the Stamp Tool&quot;</A>. <P> Tools are added by calling the Draw application viewDef <A HREF=NPG2-90.html#MARKER-9-75><EM>*</EM></A><CODE>RegTool</CODE> method. Each new tool is added to the end of the toolbar. The toolbar grows off the right end of the screen, if enough tools are added. <P> Tools are based on the <A HREF=NPG2-57.html#MARKER-9-12><EM>*</EM></A><CODE>protoDrawTool</CODE> frame. You are required to supply the following:<P><UL><LI>an icon to display in the toolbar<LI>a class symbol that identifies the tool and the object it creates<LI>a <A HREF=NPG2-58.html#MARKER-9-14><EM>*</EM></A><CODE>MakeObject</CODE> method that returns a graphic shape to add to the canvas<LI>a <A HREF=NPG2-59.html#MARKER-9-16><EM>*</EM></A><CODE>SetAttribute</CODE> method to respond to the user selecting, and perhaps modifying the object</UL> The object created should be a shape array with the same class as the tool. This array should have a style frame at the front to make sure you get the drawing environment you want. The last two objects in the array should be an "invisible" style and a rectangle shape. The rectangle should be the size of the shape you are returning, and the style frame should be:<P><PRE><P> {penSize: 0, fillPattern: vfNone, selection: nil}<P></PRE> This rectangle at the end of your shapes array is for the selection handles. <P> The default behavior of <A HREF=NPG2-57.html#MARKER-9-12><EM>*</EM></A><CODE>protoDrawTool</CODE> is to draw a bounding box as the user drags the pen across the screen. This creates a bounds box which is passed to the tool's <A HREF=NPG2-58.html#MARKER-9-14><EM>*</EM></A><CODE>MakeObject</CODE> method. You can override this behavior in a number of ways. <P> If it makes more sense to create the object with a tap, instead of by dragging a bounding box, set the tool's <CODE>createByTapping</CODE> slot to <CODE>true</CODE>, and its <CODE>createByDragging</CODE> slot to <CODE>nil</CODE>. The stamp tool, for example, creates its objects with pen taps. <P> You may also draw something other than a rectangle as the user drags the bounding box. The oval tool, for example, draws an oval as the bounding box is being created. To draw your own object, set your tool's <CODE>dragARectangle</CODE> slot to <CODE>nil</CODE>, and optionally provide a <A HREF=NPG2-60.html#MARKER-9-18><EM>*</EM></A><CODE>MakeDragObject</CODE> method. The <CODE><A HREF=NPG2-60.html#MARKER-9-18><EM>*</A>MakeDragObject</EM></CODE> method is called to return a shape as the bounding box is being dragged. The default version of this method simply sends your tool a <CODE><A HREF=NPG2-58.html#MARKER-9-14><EM>*</A>MakeObject</EM></CODE> message. If the objects your tools creates are very complicated, you may want to create a simpler object here. Your <A HREF=NPG2-60.html#MARKER-9-18><EM>*</EM></A><CODE>MakeDragObject</CODE> method could return the outline of your object, for example. <P> The example below creates a simple tool that makes a shape comprised of an equal size oval and rectangle.<P><B>Listing 2-1  <A NAME=MARKER-9-4></A>Adding a tool to the Draw application's tool bar </B><P><PRE><P> OpenResFile(Home &amp; &quot;resources&quot;);<P>DefineGlobalConstant ('kToolIcon ,       MakePixFamily ( nil, nil, {rsrcSpec:&quot;toolIcon&quot;, bitdepth:1}) );CLoseResFile();DefineGlobalConstant('kMyDrawToolTemplate,{  _proto: UR('|Draw:NEWTON|, 'protoDrawTool), // get proto from unit   class : '|OvalRect:MySig|,   icon  : kToolIcon,   MakeObject : func (left,top,right,bottom,style)    begin      local l := Min(left,right), r := Max(left,right),            t := Min(top,bottom), t := Max(top,bottom);      local oval := MakeOval (l,t,r,b);      local rect := MakeRect (l,t,r,b);      local mainStyle := Clone(style);      mainStyle.selection := nil;            [|OvalRect:MySig|:         mainStyle,         rect,         oval,         { penSize:0, fillPattern:vfNone, selection:nil },          rect,      ];   end,   SetAttribute : func ( shape, attribute, newValue )   begin      //selection handles go on the invisible rect.      if attribute = 'selection then         shape[3] . selection := newValue;      else shape[0].(attribute) := newValue;   end});InstallScript := func(partFrame, removeFrame)begin   local viewDef := GetViewDefs('drawPaper).default;   local sym := EnsureInternal(kAppSymbol);   if viewDef  then      viewDef:RegTool(sym, kMyDrawToolTemplate);end;RemoveScript := func (removeFrame) begin   local viewDef := GetViewDefs('drawPaper).default;   if viewDef then      viewDef:UnRegPatterns(kAppSymbol); end;<P><P></PRE></BLOCKQUOTE><HR><center><A HREF="NPG2-49.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-51.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><center><font size=-1><A HREF="NPG2-3.html">&copy; Apple Computer, Inc.</A><br>26 APR 1997<P><!--------------------------- Navigation Area ----------------------------------><BR><!-- Navigation Area --><BR><A HREF="reference to server cgi goes here"><IMG BORDER="0" SRC="../../../../images/nav.gif" WIDTH="500" HEIGHT="32" ALT="Navigation graphic, see text links" ISMAP USEMAP="#nav"></A><BR><P><A HREF="../../../../devworld.shtml">Main</A> | <A HREF="../../techinfo.html">Top of Section</A> | <A HREF="../../newtondev.shtml#WhatsNew">What's New</A> | <A HREF="http://www.apple.com/">Apple Computer, Inc.</A> |<A HREF="../../../../find.html">Find It</A> | <A HREF="../../feedback.html">Feedback</A> | <A HREF="../../../../help.html">Help</A></FONT><P></CENTER><!-- Don't forget to add the necessary links for each of these items. --><BR><MAP NAME="nav"><!-- client side map for www.apple.com nav.gif --><!-- Main --><AREA SHAPE="RECT" COORDS="9,6,70,25" HREF="../../../../devworld.shtml"><!-- Page One --><AREA SHAPE="RECT" COORDS="80,6,142,25" HREF="../../techinfo.html"><!-- What's New --><AREA SHAPE="RECT" COORDS="150,5,211,25" HREF="../../newtondev.shtml#WhatsNew"><!-- Apple Logo --><AREA SHAPE="RECT" COORDS="220,6,280,25" HREF="http://www.apple.com/"><!-- Find It --><AREA SHAPE="RECT" COORDS="290,5,350,26" HREF="../../../../find.html"><!-- Contact Us --><AREA SHAPE="RECT" COORDS="361,5,422,25" HREF="../../feedback.html"><!-- Help --><AREA SHAPE="RECT" COORDS="430,5,492,25" HREF="../../../../help.html"><!-- DEFAULT AREA NOT SUPPORTED BY CLIENT SIDE IMAGEMAPS! --></MAP><P></BODY></HTML> 