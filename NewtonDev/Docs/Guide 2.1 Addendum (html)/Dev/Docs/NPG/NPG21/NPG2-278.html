<!-- Generated by Harlequin WebMaker 2.3.1 (16-Oct-1996)Macintosh Common Lisp Version 4.0 --><HTML> <HEAD><TITLE>Compressing Sound</TITLE></HEAD><BODY><A NAME=HEADING278></A><CENTER>     <IMG BORDER="0" SRC="../../../../images/level3.gif" ALT="Title Banner"      ISMAP USEMAP="#level3">     <BR>     <MAP NAME="level3">     <!-- Find It -->     <AREA SHAPE="RECT" COORDS="7, 9, 69, 30" HREF="../../../../find.html">     <!-- Main -->     <AREA SHAPE="RECT" COORDS="432, 9, 492, 30" HREF="../../../../devworld.shtml">     </MAP><P><A HREF="NPG2-277.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-279.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><FONT SIZE=-1><DL><DT><A HREF="../../techinfo.html"><B>Newton Developer Technical Information:</B></A> <A HREF="NPG2-2.html"><B>Newton Programmer's Guide: 2.1 OS Addendum</B></A> / <BR><DD><A HREF="NPG2-262.html"><B>Chapter 7 - Sound</B></A> / <A HREF="NPG2-274.html"><B>Using Sound</B></A></DL></FONT><P><HR><BLOCKQUOTE><A NAME=HEADING278-0></A><H2><A NAME=MARKER-9-116></A>Compressing Sound</H2> On the Newton 2.1 OS, you can play compressed sounds and record sound, compressing it on the fly. You control sound compression by setting slots in the sound frame; for a complete description of sound frame slots, see <A HREF=NPG2-290.html#MARKER-9-131>&quot;Sound Frame&quot;</A>. The key slots controlling sound compression include:<P><UL><LI><CODE>sndFrameType</CODE>, specifying whether or not to use a codec <LI><CODE>codecName</CODE>, identifying the codec to use<LI><CODE>bufferCount</CODE>, setting how many codec buffers to allocate<LI><CODE>bufferSize</CODE>, setting the size of each codec buffer in bytes<LI><CODE>compressionType</CODE>, specifying the compression type if a codec is not used<LI><CODE>samplingRate</CODE>, specifying the number of samples per second to play or record<LI><CODE>compressionRatio</CODE>, an optional slot specifying the compression ratio for user interface updating</UL> You can compress and decompress sound using one of the built-in codecs, <A NAME=MARKER-10-117></A>as described in the following subsections.<P> In addition to using compression, you can control the resulting size of recorded sounds by varying the sampling rate used when recording. The highest quality sound results from using a sampling rate of 21600, however, this also uses the most storage. You can use lower sampling rates to decrease the size of the resulting sound object, with some loss of quality. Reasonable sampling rates are 8000 on the MessagePad 2000 unit and 10000 on the eMate 300 unit.<P> Note that playing back a sound at a sampling rate different from that at which it was recorded shifts the sound's pitch.<P><A NAME=HEADING278-12></A><H3><A NAME=MARKER-10-118></A><A NAME=MARKER-9-119></A>Using Codecs to Compress and Decompress Sound</H3> You can use one of several different codecs built into the Newton 2.1 OS to compress and decompress sounds. The codec mechanism makes use of intermediate buffers to hold the sound data, so that there are no skips in the sound caused by the system accessing VBO storage. You should use at least two buffers, and typically four buffers of the same size works well. The total size of all the buffers should be enough to hold 2-3 seconds of sound; so the size of the buffers will vary, depending on the sampling rate and the size of each sample.<P> For example, if the sampling rate is 8000 samples per second, and you are recording 16-bit samples, that yields 16 KB per second. A total buffer size of 40 KB would be adequate to handle the data. You could allocate four 10 KB buffers to satisfy this need. In the following examples, various values for buffer size are shown, depending on the sampling rate.<P> Note that if the sound sample data is not stored in a VBO, the buffers can be much smaller. <A NAME=MARKER-10-120></A><P> When using a codec, the <CODE>samplingRate</CODE>, <CODE>compressionType</CODE>, and <CODE>dataType</CODE> slots define the format of the data produced by decompression (for playback), or required for compression (for recording). They also define the format of the data in the intermediate buffers.<P> To compress or decompress sounds using the muLaw codec, set up the slots in the sound frame like this:<P><PRE><P> {sndFrameType: 'codec, // use a codec<P>codecName: &quot;TMuLawCodec&quot;, // select muLaw codecbufferSize: 10000, // size of codec buffersbufferCount: 4, // # of codec bufferscompressionType: kSampleLinear, // for playbackdataType: k16bit, // for playbacksamples: mySamples, // compressed sound objectsamplingRate: 8000, // set to any value you wantcompressionRatio: 1, // for muLaw }<P><P></PRE> The muLaw codec compresses each 16-bit sample to 8 bits.<P> To use the IMA codec, set up the slots in the sound frame like this:<P><PRE><P> {sndFrameType: 'codec, // use a codec<P>codecName: &quot;TIMACodec&quot;, // select IMA codecbufferSize: 12500, // size of codec buffersbufferCount: 4, // # of codec bufferscompressionType: kSampleLinear, // for playbackdataType: k16bit, // for playbacksamples: mySamples, // compressed sound objectsamplingRate: 10000, // set to any value you wantcompressionRatio: 64/34, // for IMA }<P><P></PRE> This example shows the same values as those used for the highest quality recording level on the Newton 2.1 devices (Music on the MessagePad 2000, and High on the eMate 300). A sampling rate of 8000 is used for the next lowest quality level (Voice 4K on the MessagePad 2000, and Low on the eMate 300).<P> The IMA codec compresses each block of 64 16-bit samples to 34 bytes, saving 73% over no compression.<P> To use the GSM codec, set up the slots in the sound frame like this:<P><PRE><P> {sndFrameType: 'codec, // use a codec<P>codecName: &quot;TGSMCodec&quot;, // select GSM codecbufferSize: 10000, // size of codec buffersbufferCount: 4, // # of codec bufferscompressionType: kSampleLinear, // for playbackdataType: k16bit, // for playbacksamples: mySamples, // compressed sound objectsamplingRate: 8000, // set to any value you wantcompressionRatio: 160/33, // for GSM }<P><P></PRE> This example shows the same values as those used for the lowest quality recording level on the MessagePad 2000 device. Note that GSM is a mathematically intensive compression technique that works effectively only on fast processors, such as that used in the MessagePad 2000. It is possible to play GSM-encoded sounds on the eMate 300, but not to record them.<P> The GSM codec compresses each block of 160 16-bit samples to 33 bytes, saving 90% over no compression.<P></BLOCKQUOTE><HR><center><A HREF="NPG2-277.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-279.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><center><font size=-1><A HREF="NPG2-3.html">&copy; Apple Computer, Inc.</A><br>26 APR 1997<P><!--------------------------- Navigation Area ----------------------------------><BR><!-- Navigation Area --><BR><A HREF="reference to server cgi goes here"><IMG BORDER="0" SRC="../../../../images/nav.gif" WIDTH="500" HEIGHT="32" ALT="Navigation graphic, see text links" ISMAP USEMAP="#nav"></A><BR><P><A HREF="../../../../devworld.shtml">Main</A> | <A HREF="../../techinfo.html">Top of Section</A> | <A HREF="../../newtondev.shtml#WhatsNew">What's New</A> | <A HREF="http://www.apple.com/">Apple Computer, Inc.</A> |<A HREF="../../../../find.html">Find It</A> | <A HREF="../../feedback.html">Feedback</A> | <A HREF="../../../../help.html">Help</A></FONT><P></CENTER><!-- Don't forget to add the necessary links for each of these items. --><BR><MAP NAME="nav"><!-- client side map for www.apple.com nav.gif --><!-- Main --><AREA SHAPE="RECT" COORDS="9,6,70,25" HREF="../../../../devworld.shtml"><!-- Page One --><AREA SHAPE="RECT" COORDS="80,6,142,25" HREF="../../techinfo.html"><!-- What's New --><AREA SHAPE="RECT" COORDS="150,5,211,25" HREF="../../newtondev.shtml#WhatsNew"><!-- Apple Logo --><AREA SHAPE="RECT" COORDS="220,6,280,25" HREF="http://www.apple.com/"><!-- Find It --><AREA SHAPE="RECT" COORDS="290,5,350,26" HREF="../../../../find.html"><!-- Contact Us --><AREA SHAPE="RECT" COORDS="361,5,422,25" HREF="../../feedback.html"><!-- Help --><AREA SHAPE="RECT" COORDS="430,5,492,25" HREF="../../../../help.html"><!-- DEFAULT AREA NOT SUPPORTED BY CLIENT SIDE IMAGEMAPS! --></MAP><P></BODY></HTML> 