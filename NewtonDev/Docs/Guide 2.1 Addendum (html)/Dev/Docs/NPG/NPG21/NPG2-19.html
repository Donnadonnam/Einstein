<!-- Generated by Harlequin WebMaker 2.3.1 (16-Oct-1996)Macintosh Common Lisp Version 4.0 --><HTML> <HEAD><TITLE>Creating the ViewDef</TITLE></HEAD><BODY><A NAME=HEADING19></A><CENTER>     <IMG BORDER="0" SRC="../../../../images/level3.gif" ALT="Title Banner"      ISMAP USEMAP="#level3">     <BR>     <MAP NAME="level3">     <!-- Find It -->     <AREA SHAPE="RECT" COORDS="7, 9, 69, 30" HREF="../../../../find.html">     <!-- Main -->     <AREA SHAPE="RECT" COORDS="432, 9, 492, 30" HREF="../../../../devworld.shtml">     </MAP><P><A HREF="NPG2-18.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-20.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><FONT SIZE=-1><DL><DT><A HREF="../../techinfo.html"><B>Newton Developer Technical Information:</B></A> <A HREF="NPG2-2.html"><B>Newton Programmer's Guide: 2.1 OS Addendum</B></A> / <BR><DD><A HREF="NPG2-12.html"><B>Chapter 1 - Newton Works</B></A> / <A HREF="NPG2-16.html"><B>Using the Newton Works Interface</B></A></DL></FONT><P><HR><BLOCKQUOTE><A NAME=HEADING19-0></A><H2>Creating the ViewDef</H2> Certain slots are required for all viewDefs, such as <CODE>symbol</CODE>, <CODE>type</CODE>, <CODE>protection</CODE>, etc. These slots are not documented in this chapter unless their values are Newton Works-specific. For details on the standard viewDef slots and methods, refer to the "Stationery Reference" chapter of <I>Newton Programmer's Reference</I>. For information regarding viewDefs for printing (print formats) refer to the "Routing Interface Reference" chapter of <I>Newton Programmer's Reference</I>. Newton Works does not expect any slots other than the standard ones required for all print formats. <P> For the main viewDef, the methods and slots that Newton Works uses are explained in the following subsections according to their function.<P><A NAME=HEADING19-3></A><H3><A NAME=MARKER-9-24></A>Supporting Document Find</H3> A Newton Works document Find operation is a search initiated by the user invoking the Find or Find Again commands in an open Newton Works document. Such a search operates only on the open document. Contrast this with a Newton Find operation, which applies to all or selected installed applications. Supporting the latter kind of Find operation is described in the section <A HREF=NPG2-18.html#MARKER-9-23>&quot;Supporting Newton Find Operations&quot;</A>.<P> To support a document Find operation, your viewDef is responsible for putting the Find and Find Again commands into the appropriate button in the application status bar. To do this, add the items <CODE>{keyMessage: 'NewtworksFind}</CODE> and <CODE>{keyMessage: 'NewtworksFindAgain}</CODE> to the appropriate picker array. Typically, these commands are found in the picker displayed by the Tools button. The methods <CODE>NewtworksFind</CODE> and <CODE>NewtworksFindAgain</CODE> are defined in Newton Works, so the behavior will be correct as long as these methods are called. For example, the behavior for the Find command is to display the Find slip, shown in <A HREF=#MARKER-9-25>Figure 1-4</A>. <P> For more information about adding items with command-key shortcuts to pickers, see the section <A HREF=NPG2-163.html#MARKER-9-20>&quot;About Displaying Command-Key Combinations in Menus&quot;</A>. This section explains the usage of the <CODE>keyMessage</CODE> slot shown above.<P><B>Figure 1-4  <A NAME=MARKER-9-25></A>Find slip</B><P><IMG ALIGN = BOTTOM SRC = "graphics/NWDocFnd.jpg"><BR><BR> Next, your viewDef must implement the <A HREF=NPG2-33.html#MARKER-9-50><EM>*</EM></A><CODE>FindChange</CODE> method. This method is called when the user taps one of the action buttons ("Change All", "Change," "Change,Find," or "Find") in the Find slip. This method is passed two parameters: the first identifies the action requested by the user, and the second contains the string to find, and the string to replace it with, if appropriate (for a Change action). Your <A HREF=NPG2-33.html#MARKER-9-50><EM>*</EM></A><CODE>FindChange</CODE> method must do the requested find or replace operation and update the view appropriately. <P> The recommended user interface guidelines for doing find or replace operations are as follows:<P><UL><LI>Start the find or replace operation from the current highlight range, or from the insertion point if there is no highlight range.<LI>Wrap the search around to the beginning of the document if the end is reached, making a page flipping sound when the end of the document is passed.<LI>Stop when the entire document has been searched.<LI>For a find operation, if an item is found, display the portion of the document containing the item and highlight the item.</UL> If you don't implement the <A HREF=NPG2-33.html#MARKER-9-50><EM>*</EM></A><CODE>FindChange</CODE> method, do not add the Find and Find Again commands to a picker, since Find can't operate in your viewDef.<P><A NAME=HEADING19-16></A><H3>Supporting Data Storage</H3> Newton Works automatically handles saving the current entry periodically (every 30 seconds or after 2 seconds of no system activity). Before saving the entry, Newton Works sends your viewDef the <A HREF=NPG2-39.html#MARKER-9-62><EM>*</EM></A><CODE>SaveData</CODE> message. The <CODE><A HREF=NPG2-39.html#MARKER-9-62><EM>*</A>SaveData</EM></CODE> method is passed the current entry. In this method, you can update any slots or data structures in the entry or do any other processing necessary.<P> You must return a value indicating if the entry should actually be saved. Return <CODE>nil</CODE> if it does not need to be saved or <CODE>true</CODE> to save the entry. Alternatively, you can return the symbol <CODE>'NoRealChange</CODE>. This causes the entry to be saved, but the modification time stamp is not updated. You might want to do this if the change was insignificant, such as a change in the highlight location but not a change in the data itself.<P><DL><DT><B>Note</B><DD>Even if you return <CODE>nil</CODE> from <A HREF=NPG2-39.html#MARKER-9-62><EM>*</EM></A><CODE>SaveData</CODE>, the entry still might be saved, if Newton Works detects that it has been modified, for example by one of the NewtApp framework protos.  <IMG ALIGN = BOTTOM SRC = "graphics/diamond.gif"></DL> Note that your <A HREF=NPG2-39.html#MARKER-9-62><EM>*</EM></A><CODE>SaveData</CODE> method does not actually do the saving operation. That is performed by Newton Works after <A HREF=NPG2-39.html#MARKER-9-62><EM>*</EM></A><CODE>SaveData</CODE> returns. Also, your <CODE><A HREF=NPG2-39.html#MARKER-9-62><EM>*</A>SaveData</EM></CODE> method does not need to check all the viewDef fields to see if they have changed, if your fields are based on the NewtApp slot-view protos. That is because these slot-view protos handle saving their own data when it is changed.<P> In addition to the automatic periodic saving that Newton Works performs, you can manually invoke a save operation on the current entry by calling the <CODE>newtEntryView</CODE> method <CODE>StartFlush</CODE>. Just send this message to <CODE>self</CODE>, like this:<P><PRE><P> :StartFlush();<P></PRE> The <CODE>StartFlush</CODE> method starts the flush timer that calls the method <CODE>EndFlush</CODE> after 5 seconds. <CODE>EndFlush</CODE> sends your viewDef the <A HREF=NPG2-39.html#MARKER-9-62><EM>*</EM></A><CODE>SaveData</CODE> message, as described previously, and saves the entry, if appropriate. This is the standard way of saving stationery data outside the automatic saving mechanism described previously.<P> It is possible for your <A HREF=NPG2-39.html#MARKER-9-62><EM>*</EM></A><CODE>SaveData</CODE> method to be passed an entry that is invalid or read-only. In the <A HREF=NPG2-39.html#MARKER-9-62><EM>*</EM></A><CODE>SaveData</CODE> method, before you do begin any operations that write to the soup entry, you should perform this check:<P><PRE><P> If EntryValid(entry) and not EntryStore(entry):IsReadOnly()<P>    then // do the operation<P><P></PRE><A NAME=HEADING19-28></A><H3><A NAME=MARKER-9-26></A>Supporting Scrolling</H3> If the documents created by your stationery can be larger than what can be displayed on the screen at one time, then you'll want to provide a mechanism for the user to scroll the view. Newton Works can display scroll bars for you and can facilitate scrolling with some support from you in your viewDef.<P> First, you must supply the method <CODE>GetScrollableRect</CODE> in your viewDef. This method must return a bounds frame that describes the rectangle enclosing the scrollable part of the view (usually the currently visible part of the data, not including rulers or other tools). Newton Works automatically displays scroll bars at the right side and bottom of the view, as needed. The scroll bars are displayed in the stationery's topmost view, not inside the scrollable view.<P> If you return <CODE>nil</CODE> from <CODE>GetScrollableRect</CODE>, Newton Works does not display any scroll bars and scrolling functionality is not supplied by Newton Works. You can return <CODE>nil</CODE> if you want to provide your own scrolling functionality or if you don't need scrolling.<P> You also must supply a group of methods in the viewDef that return status information. <CODE>GetScrollValues</CODE> should return <CODE>{x: (1000 - width), y: (1000 - height)}</CODE>.<P> Next, you may want to supply methods that update your view in response to a scroll request. Two methods, <CODE>ViewScrollDownScript</CODE> and <CODE>ViewScrollUpScript</CODE> must update the view in response to a Down or Up arrow key, respectively. If you don't define these methods, then Newton Works performs the default action of scrolling down or up one screenful.<P> Finally, the <CODE>Scroll</CODE> method is passed a frame with x and y slots, describing how far to scroll in each direction. <P> Note that you must call the Newton Works method <A HREF=NPG2-42.html#MARKER-9-69><EM>*</EM></A><CODE>UpdateAllScrollers</CODE> from your <CODE>Scroll</CODE> as needed to recalculate the internal scroller data structures.<P><A NAME=HEADING19-36></A><H3><A NAME=MARKER-9-27></A>Providing Status Bar Buttons</H3> To provide any custom buttons in the status bar, you can specify button view templates in one of two slots in your viewDef: <CODE>statusLeftButtons</CODE> and <CODE>statusRightButtons</CODE>. Specify an array of one or more button templates in the <CODE>statusLeftButtons</CODE> slot to include them at the left side of the status bar, but to the right of the New button, as shown in <A HREF=#MARKER-9-28>Figure 1-5</A>. They are laid out from left to right, beginning with the first button in the array.<P> Specify an array of one or more button frames in the <CODE>statusRightButtons</CODE> slot to include them at the right side of the status bar, but to the left of the Routing and Filing buttons. They are laid out from right to left, beginning with the first button in the array.<P><B>Figure 1-5  <A NAME=MARKER-9-28></A>Status bar buttons</B><P><IMG ALIGN = BOTTOM SRC = "graphics/NWStsBar.jpg"><BR><BR> If you are registering tools for your Newton Works stationery or documenting your tool format for other developers to use, you should include a Tools button on the status bar that displays a picker listing the installed tools. You can use the Newton Works method <A HREF=NPG2-24.html#MARKER-9-36><EM>*</EM></A><CODE>GetNewtWorksTools</CODE> to return an array of tools registered for your stationery.<P> There is a notification method that you can supply in your viewDef that is called if some other package installs or removes an auxiliary button in the Newton Works status bar. This method is <CODE>UpdateStatusBar</CODE> message simply allows you to update your own buttons.<P> This viewDef method is also called anytime the status bar is redrawn by the <CODE>newtApp</CODE> base method <CODE>UpdateStatusBar</CODE>. For example, this can happen when the screen is rotated, and you might want to show a different number of buttons depending on how much screen width is available.<P> The <CODE>newtApp</CODE> base <CODE>UpdateStatusBar</CODE> method. Whatever you set up in the two button arrays in your method is added to the existing status bar buttons when the status bar is redrawn.<P><A NAME=HEADING19-45></A><H3><A NAME=MARKER-9-29></A>Providing Help</H3> The user accesses Help by tapping the Help command in the Information picker ("i" button on the status bar). When this command is chosen, you can either do a custom operation for your stationery, or open a help book, or both. When this command is chosen, Newton Works first conditionally sends your viewDef the <A HREF=NPG2-32.html#MARKER-9-48><EM>*</EM></A><CODE>DoHelp</CODE> message. You can do any kind of special processing in this method. If you also want to open a help book, you must return the symbol <CODE>'loadHelp</CODE> from the <A HREF=NPG2-32.html#MARKER-9-48><EM>*</EM></A><CODE>DoHelp</CODE> method.<P> If <A HREF=NPG2-32.html#MARKER-9-48><EM>*</EM></A><CODE>DoHelp</CODE> is not implemented, or if it returns <CODE>'loadHelp</CODE>, then Newton Works opens a help book. Two slots in the viewDef are used to identify the help book and location to which it is opened: <CODE>helpManual</CODE> and <CODE>viewHelpTopic</CODE>. The <CODE>helpManual</CODE> slot must contain a help book frame (the <CODE>book</CODE> frame produced by Newton Book Maker). The <CODE>viewHelpTopic</CODE> slot sets the topic to which that help book should open. This must be a string that matches one of the <CODE>.subject</CODE> lines in the help book. Refer to <I>Newton Book Maker User's Guide</I> and the sample code available on help books for more details about help book frames and topics.<P><A NAME=HEADING19-48></A><H3><A NAME=MARKER-10-30></A><A NAME=MARKER-9-119></A>Notification of Changes</H3> There are global preferences that apply to all Newton Works applications. These are accessed by the user through the Works Prefs choice on the Info picker. Currently, the global preferences contain two items: a choice of using metric measurement units (rather than English) and a setting to always store new documents internally (rather than on a storage card).<P> If the global preferences for Newton Works are changed, Newton Works sends the current viewDef the <A HREF=NPG2-38.html#MARKER-9-60><EM>*</EM></A><CODE>PrefsChanged</CODE> message, passing the global preferences frame. This allows you to respond appropriately, if necessary, to the user's wishes.<P> If the view bounds of your view change, Newton Works sends the viewDef the <CODE>ViewChangedScript</CODE> message. This could happen if the horizontal scroller is no longer needed, or if the icon bar is moved from the side to the bottom on a MessagePad 2000 unit, and so forth. This viewDef method is a standard view method that is also called anytime a view is changed as a result of a <CODE>SetValue</CODE> call.<P> The <CODE>ViewChangedScript</CODE> method is passed two parameters, the slot that changed and the view that changed. For more information, see the <I>Newton Programmer's Reference</I>.<P></BLOCKQUOTE><HR><center><A HREF="NPG2-18.html"><IMG ALIGN = BOTTOM SRC = "graphics/prev.gif" border=none hspace=20 alt="Previous"></A> <A HREF="NPG2-2.html"><IMG ALIGN = BOTTOM SRC = "graphics/content.gif" border=none hspace=20 alt="Book Contents"></A> <A HREF="NPG2-443.html"><IMG ALIGN = BOTTOM SRC = "graphics/index.gif" border=none hspace=20 alt="Book Index"></A> <A HREF="NPG2-20.html"><IMG ALIGN = BOTTOM SRC = "graphics/next.gif" border=none hspace=20 alt="Next"></A> </CENTER><P><center><font size=-1><A HREF="NPG2-3.html">&copy; Apple Computer, Inc.</A><br>26 APR 1997<P><!--------------------------- Navigation Area ----------------------------------><BR><!-- Navigation Area --><BR><A HREF="reference to server cgi goes here"><IMG BORDER="0" SRC="../../../../images/nav.gif" WIDTH="500" HEIGHT="32" ALT="Navigation graphic, see text links" ISMAP USEMAP="#nav"></A><BR><P><A HREF="../../../../devworld.shtml">Main</A> | <A HREF="../../techinfo.html">Top of Section</A> | <A HREF="../../newtondev.shtml#WhatsNew">What's New</A> | <A HREF="http://www.apple.com/">Apple Computer, Inc.</A> |<A HREF="../../../../find.html">Find It</A> | <A HREF="../../feedback.html">Feedback</A> | <A HREF="../../../../help.html">Help</A></FONT><P></CENTER><!-- Don't forget to add the necessary links for each of these items. --><BR><MAP NAME="nav"><!-- client side map for www.apple.com nav.gif --><!-- Main --><AREA SHAPE="RECT" COORDS="9,6,70,25" HREF="../../../../devworld.shtml"><!-- Page One --><AREA SHAPE="RECT" COORDS="80,6,142,25" HREF="../../techinfo.html"><!-- What's New --><AREA SHAPE="RECT" COORDS="150,5,211,25" HREF="../../newtondev.shtml#WhatsNew"><!-- Apple Logo --><AREA SHAPE="RECT" COORDS="220,6,280,25" HREF="http://www.apple.com/"><!-- Find It --><AREA SHAPE="RECT" COORDS="290,5,350,26" HREF="../../../../find.html"><!-- Contact Us --><AREA SHAPE="RECT" COORDS="361,5,422,25" HREF="../../feedback.html"><!-- Help --><AREA SHAPE="RECT" COORDS="430,5,492,25" HREF="../../../../help.html"><!-- DEFAULT AREA NOT SUPPORTED BY CLIENT SIDE IMAGEMAPS! --></MAP><P></BODY></HTML> 